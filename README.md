# Introduction

UserCycleManagement is a Spring Boot Java REST API application developed to operate within a microservice architecture.
It utilizes a cloud-based MongoDB (version 7.0.12) for data management, focusing on three primary collections: cycle, user, and dailyUsage.

# Overview

UserCycleManagement offers APIs for managing mobile phone usage and customer billing cycles. It's designed to efficiently handle large volumes of data, with the capability to manage millions of documents. The APIs enable querying of both current and historical usage data, as well as managing user information.

# Prerequisites

The project is built on Java and Spring Boot and is containerised on docker for scalability and easy deployment.
Here is the list of prerequisites to run the project:

- **Java 18** - Ensure you have Java 18 installed on your machine. You can download it from [here](https://www.oracle.com/java/technologies/javase-jdk18-downloads.html).
- **Gradle Wrapper** - The project uses the Gradle build tool. The gradle wrapper scripts enable to run the project without pre-installed gradle setup. 
- **Spring Boot** - The project is built on Spring Boot.
- **Docker** - The project is containerised on Docker. Ensure you have Docker installed on your machine. You can download it from [here](https://www.docker.com/products/docker-desktop).
- **MongoDB** - The project uses MongoDB as the database. You can use a cloud-based MongoDB service like MongoDB Atlas or install MongoDB locally on your machine. You can download MongoDB from [here](https://www.mongodb.com/try/download/community).

# Installation and Setup

Follow these steps to clone the application and run it on Docker:

1. **Clone the Repository**

Open your terminal and navigate to the directory where you want to clone the project. Then, run the following command:

    git clone git@github.com:vatsa28/userCycleManagement.git
2. **Navigate to the Project Directory**
   
After cloning the repository, navigate to the project directory:

    cd userCycleManagement
3. **Build the Project with Gradle**
   
The project uses Gradle as a build tool. You can use the Gradle Wrapper included in the project to build it. Run the following command:

    ./gradlew clean build (or)
    ./gradlew clean build -x test (without Unit Tests)

4. **Build the Docker Image**
   
Before you can run the application on Docker, you need to build a Docker image of the application. Make sure you have Docker installed on your machine. Then, run the following command:

    docker build -t userCycleManagement .

5. **Run the Docker Container**

After the Docker image has been built, you can run it with the following command:

    docker run -p 8080:8080 userCycleManagement

This command runs the Docker image and maps the application's port (8080) to the same port on your machine.

Please note that this application uses MongoDB as a database. You need to have a running MongoDB instance and provide the connection details to the application. 

I added my mongodb URI in application.properties. If we want to update it, can be added as an environment variable while running the docker run command.

    docker run -e "SPRING_DATA_MONGODB_URI=<spring Data URI> -p 8080:8080 userCycleManagement

# Database Design

## Schema Design

The database schema consists of three primary collections: cycle, user, and dailyUsage. Here is a brief overview of each collection:

1. **Cycle Collection** - The cycle collection stores information about the billing cycle for each user. It includes fields such as id, mdn, startDate, endDate, and userId.
2. **User Collection** - The user collection stores information about each user. It includes fields such as is, firstName, lastName, email and password.
3. **DailyUsage Collection** - The dailyUsage collection stores daily usage data for each user. It includes fields such as id, mdn, userId, usageDate, usedInMb.

## Scalability and Performance

1. **Cycle Collection** - Assumed to have 10 million documents.
2. **User Collection** - Assumed to have 1 million documents.
3. **DailyUsage Collection** - Assumed to have 100 million documents.

The database schema is designed to handle large volumes of data efficiently. 
Indexes are created on fields that are frequently queried. This helps to improve query performance and reduce the time taken to fetch data.
Here are details of the indexes created on each collection:

1. **Cycle Collection** - Compound Index on userId and mdn fields.
2. **User Collection** - Index on email field.
3. **DailyUsage Collection** - Compound Index on userId, mdn and usageDate fields.

All the collections are indexed on id field which is automatically generated by MongoDB for efficient querying.

# API Documentation

The detailed API documentation is available [here](./API_DOC.md).

# Github Actions

The project is integrated with Github Actions for Continuous Integration. 
The CI pipeline runs the Gradle build and tests on every push to the repository and then create a docker image out of it and pushes to  docker repo. 
The pipeline is defined in the `.github/workflows/ci.yml` file.

# Conclusion
